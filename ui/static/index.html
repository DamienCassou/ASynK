<html>
<head>
<script src="/static/js/vendor/jquery-1.10.1.min.js"></script>
<script>
$().ready(function(){

    var ws = new WebSocket("ws://localhost:8888/appresponse");
    ws.onopen = function() {
       //ws.send("python asynk.py --op=sync --pwd=");
    };
    ws.onmessage = function (evt) {
       $("div#log").append(evt.data);
       //alert(evt.data);
    };

    //load profile names
    $.getJSON("/profiles",
        function(data){
            for (x in data){
                $("#profile").append("<option value=\""+data[x]+"\">"+data[x]+"</option>");
            }
        });

    //load profile variables on choosing a profile
    $("#profile").change(function(){
        if ($("#profile").val()!=0){
            $.getJSON("/pdata/"+$("#profile").val(),
            function(data){
                $("#db1").val(data["db1"]);
                $("#uname1").val(data["uname1"]);
                $("#db2").val(data["db2"]);
                $("#uname2").val(data["uname2"]);
            });
        }
    });

    //preparing the sync command
    $("input#sync").click(function(evt){

        opts1=opts2="";
        if ($("#db1").val()=='cd') {
            opts1+=" --cduser="+$("#uname1").val()+" cdpwd="+$("#pass1").val();
        }
        else if ($("#db1").val()=='gc') {
            opts1+=" --pwd="+$("#pass1").val();
        }
        if ($("#db2").val()=='cd') {
            opts2+=" --cduser="+$("#uname2").val()+" cdpwd="+$("#pass2").val();
        }
        else if ($("#db2").val()=='gc') {
            opts1+=" --pwd="+$("#pass2").val();
        }
        opts1=opts2="";
        ws.send("python asynk.py --op=sync --name="+$("#profile").val()+opts1+opts2);
        //ws.send ("python asynk.py --op=sync --name="+$("#profile").val());
    });


});
</script>
</head>
<body>
    Profile:
      <select id="profile" name="db1">
          <option value="0">Choose a profile for quick sync</option>
      </select>
      <br>
<table style="text-align: left;" cellpadding="2" cellspacing="2" width="100%">
  <tbody><tr>
      <td>DB 1:
      <select id="db1" name="db1">
        <option value="bb">BBDB</option>
        <option value="gc">Google</option>
        <option value="ol">Outlook</option>
        <option value="cd">CardDAV</option>
      </select>
      <br>
      <br>
        Username: <input id="uname1" name="uname1"><br>
        Password: <input id="pass1" name="pass1" type="password"><br>
      <br>
      </td>
      <td>DB 2:
      <select id="db2" name="db2">
        <option value="bb">BBDB</option>
        <option value="gc">Google</option>
        <option value="ol">Outlook</option>
        <option value="cd">CardDAV</option>
      </select>
      <br>
      <br>
        Username: <input id="uname2" name="uname2"><br>
        Password:<input id="pass2" name="pass2" type="password"><br><br>
      </td>
      <td><input id="sync" name="btnSync" value="Sync " type="button"><br>
      <input value="Dry Run" name="dryrun" type="button">
      </td>
    </tr>
  </tbody>
</table>
<div id="log">..</div>
</body>
</html>
